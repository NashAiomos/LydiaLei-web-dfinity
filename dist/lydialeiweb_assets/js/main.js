var tocItems,pathLength,lastPathStart,lastPathEnd,toc=document.querySelector(".toc"),tocPath=document.querySelector(".toc-marker path"),TOP_MARGIN=.1,BOTTOM_MARGIN=.2;function drawPath(){tocItems=(tocItems=(tocItems=[].slice.call(toc.querySelectorAll("li"))).map((function(t){var e=t.querySelector("a"),i=document.getElementById(e.getAttribute("href").slice(1));return{listItem:t,anchor:e,target:i}}))).filter((function(t){return!!t.target}));var t,e=[];tocItems.forEach((function(i,s){var a=i.anchor.offsetLeft-5,h=i.anchor.offsetTop,r=i.anchor.offsetHeight;0===s?(e.push("M",a,h,"L",a,h+r),i.pathStart=0):(t!==a&&e.push("L",t,h),e.push("L",a,h),tocPath.setAttribute("d",e.join(" ")),i.pathStart=tocPath.getTotalLength()||0,e.push("L",a,h+r)),t=a,tocPath.setAttribute("d",e.join(" ")),i.pathEnd=tocPath.getTotalLength()})),pathLength=tocPath.getTotalLength(),sync()}function sync(){var t=window.innerHeight,e=pathLength,i=0,s=0;tocItems.forEach((function(a){var h=a.target.getBoundingClientRect();h.bottom>t*TOP_MARGIN&&h.top<t*(1-BOTTOM_MARGIN)?(e=Math.min(a.pathStart,e),i=Math.max(a.pathEnd,i),s+=1,a.listItem.classList.add("visible")):a.listItem.classList.remove("visible")})),s>0&&e<i?e===lastPathStart&&i===lastPathEnd||(tocPath.setAttribute("stroke-dashoffset","1"),tocPath.setAttribute("stroke-dasharray","1, "+e+", "+(i-e)+", "+pathLength),tocPath.setAttribute("opacity",1)):tocPath.setAttribute("opacity",0),lastPathStart=e,lastPathEnd=i}window.addEventListener("resize",drawPath,!1),window.addEventListener("scroll",sync,!1),drawPath();let mx,my,canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),cw=window.innerWidth,ch=window.innerHeight,fireworks=[],particles=[],hue=120,limiterTotal=80,limiterNow=0;function random(t,e){return Math.random()*(e-t)+t}function calculateDistance(t,e,i,s){var a=t-i,h=e-s;return Math.sqrt(Math.pow(a,2)+Math.pow(h,2))}function Firework(t,e,i,s){for(this.x=t,this.y=e,this.sx=t,this.sy=e,this.tx=i,this.ty=s,this.distanceToTarget=calculateDistance(t,e,i,s),this.distanceTraveled=0,this.angle=Math.atan2(s-e,i-t),this.speed=2,this.acceleration=1.05,this.brightness=random(50,70),this.targetRadius=1,this.coordinateCount=3,this.coordinates=[];this.coordinateCount--;)this.coordinates.push([this.x,this.y])}function Particle(t,e){for(this.x=t,this.y=e,this.angle=random(0,2*Math.PI),this.speed=random(1,10),this.friction=.95,this.gravity=1,this.hue=random(hue-20,hue+20),this.brightness=random(50,80),this.alpha=1,this.decay=random(.015,.03),this.coordinates=[],this.coordinateCount=5;this.coordinateCount--;)this.coordinates.push([this.x,this.y])}function createParticle(t,e){let i=100;for(;i--;)particles.push(new Particle(t,e))}function run(){hue++,ctx.fillStyle="rgba(0, 10, 29, 0.5)",ctx.fillRect(0,0,cw,ch);for(var t=fireworks.length;t--;)fireworks[t].draw(),fireworks[t].update(t);for(var e=particles.length;e--;)particles[e].draw(),particles[e].update(e);limiterNow>=limiterTotal?(fireworks.push(new Firework(cw/2,ch,random(0,cw),random(0,ch/2))),fireworks.push(new Firework(cw/2,ch,random(0,cw),random(0,ch/2))),fireworks.push(new Firework(cw/2,ch,random(0,cw),random(0,ch/2))),fireworks.push(new Firework(cw/2,ch,random(0,cw),random(0,ch/2))),fireworks.push(new Firework(cw/2,ch,random(0,cw),random(0,ch/2))),limiterNow=0):limiterNow++}canvas.width=cw,canvas.height=ch,Firework.prototype.draw=function(){ctx.beginPath(),ctx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),ctx.lineTo(this.x,this.y),ctx.strokeStyle="hsl("+hue+",100%,"+this.brightness+"%)",ctx.stroke(),ctx.beginPath(),ctx.arc(this.tx,this.ty,this.targetRadius,0,2*Math.PI),ctx.stroke()},Firework.prototype.update=function(t){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.targetRadius<8?this.targetRadius+=.3:this.targetRadius=1,this.speed=this.speed*this.acceleration;let e=Math.cos(this.angle)*this.speed,i=Math.sin(this.angle)*this.speed;this.distanceTraveled=calculateDistance(this.sx,this.sy,this.x+e,this.y+i),this.distanceTraveled>=this.distanceToTarget?(fireworks.splice(t,1),createParticle(this.tx,this.ty)):(this.x+=e,this.y+=i)},Particle.prototype.draw=function(){ctx.beginPath(),ctx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),ctx.lineTo(this.x,this.y),ctx.strokeStyle="hsla("+hue+",100%,"+this.brightness+"%,"+this.alpha+")",ctx.stroke()},Particle.prototype.update=function(t){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&particles.splice(t,1)},canvas.addEventListener("mousedown",(function(t){mx=t.pageX-canvas.offsetLeft,my=t.pageY-canvas.offsetTop,fireworks.push(new Firework(cw/2,ch,mx,my))})),setInterval(run,33);